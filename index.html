<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3537</title>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: #2D2D2D;
            color: #F5F5F5;
            line-height: 1.6;
        }
        .header-buttons {
            text-align: center;
            margin-bottom: 40px;
        }
        .header-buttons button {
            font-size: 2.5em;
            font-weight: 600;
            padding: 10px 20px;
            margin: 0 10px;
            background: #00CC66;
            color: #FFFFFF;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .header-buttons button:hover {
            background: #FFCC00;
        }
        .header-buttons button:active {
            background: #E6B800;
        }
        .header-buttons button.active {
            background: #FFCC00;
        }
        .input-section {
            margin-bottom: 30px;
            background: #3A3A3A;
            padding: 20px;
            border-radius: 6px;
            box-shadow: none;
        }
        label {
            font-weight: 600;
            color: #FFCC00;
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        textarea, .editable-div {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            resize: vertical;
            background: #4A4A4A;
            color: #F5F5F5;
            border: none;
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        textarea:hover, .editable-div:hover {
            background: #5A5A5A;
        }
        textarea:focus, .editable-div:focus {
            background: #5A5A5A;
            outline: none;
        }
        #title {
            min-height: 40px;
        }
        #content {
            min-height: 140px;
            white-space: pre-wrap;
        }
        .toolbar {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .align-toolbar {
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button, select {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        button {
            background: #00CC66;
            color: #FFFFFF;
            font-weight: 600;
        }
        button:hover {
            background: #FFCC00;
        }
        button:active {
            background: #E6B800;
        }
        select {
            background: #4A4A4A;
            color: #F5F5F5;
            padding: 10px;
        }
        select:focus {
            outline: none;
        }
        select option {
            background: #4A4A4A;
            color: #FFCC00;
        }
        #output {
            white-space: pre-wrap;
            padding: 15px;
            border-radius: 4px;
            background: #3A3A3A;
            color: #E0E0E0;
            margin-top: 20px;
            font-family: 'JetBrains Mono', monospace;
            position: relative;
        }
        #bottom-preview {
            margin-top: 10px;
            padding: 12px;
            border-radius: 4px;
            background: #4A4A4A;
            min-height: 50px;
            text-align: center;
        }
        #content img.button-img {
            width: 100px;
            vertical-align: middle;
        }
        #content img.emoji-img {
            width: 30px;
            vertical-align: middle;
        }
        #content table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        #content td {
            border: 1px solid #FFFFFF;
            padding: 8px;
            text-align: center;
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 30px;
        }
        .divider {
            border-top: 1px solid #5A5A5A;
            margin: 30px 0;
        }
        .copy-success {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFCC00;
            color: #2D2D2D;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 1.1em;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        .copy-success.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header-buttons">
        <button id="btn-3537" class="active" onclick="switchMode('3537')">✨ 3537 ✨</button>
        <button id="btn-6167" onclick="switchMode('6167')">✨ 6167 ✨</button>
    </div>

    <div class="input-section">
        <label>📝 主题</label>
        <textarea id="title" placeholder="输入主题"></textarea>
    </div>

    <div class="input-section">
        <label>📋 内容</label>
        <div class="align-toolbar">
            <button onclick="alignText('left')">⬅️ 左对齐</button>
            <button onclick="alignText('center')">↔️ 居中对齐</button>
            <button onclick="alignText('right')">➡️ 右对齐</button>
            <button onclick="addTable()">📊 添加表格</button>
            <button onclick="formatText('bold')">𝐁 加粗</button>
            <button onclick="formatText('italic')">𝐼 斜体</button>
            <button onclick="formatText('underline')">𝐔 下划线</button>
        </div>
        <div id="content" class="editable-div" contenteditable="true" oninput="updateContent()"></div>
        <div class="toolbar">
            <button onclick="changeSelectedColor()">🎨 颜色</button>
            <button onclick="addButton()">➕ 添加按钮</button>
            <select id="emojiSelect" onchange="addEmoji()">
                <option value="">选择游戏 Emoji</option>
                <option value="JDB">JDB</option>
                <option value="PG">PG</option>
                <option value="CQ9">CQ9</option>
                <option value="PP">PP</option>
                <option value="JILI">JILI</option>
                <option value="TADA">TADA</option>
                <option value="WG">WG</option>
            </select>
        </div>
    </div>

    <div class="input-section">
        <label>🔗 底部选项</label>
        <div class="toolbar">
            <button onclick="addJumpButton()">🔗 添加跳转按钮</button>
            <select id="bannerSelect" onchange="addBanner()">
                <option value="">选择横幅</option>
                <option value="VIP活动">VIP活动</option>
                <option value="代理R$30">代理R$30</option>
                <option value="5%佣金">5%佣金</option>
                <option value="神秘奖金R$8888">神秘奖金R$8888</option>
                <option value="MAGNATA">MAGNATA</option>
                <option value="每日亏损">每日亏损</option>
                <option value="每周亏损">每周亏损</option>
                <option value="Nível">Nível</option>
                <option value="HAPPY">HAPPY</option>
                <option value="5号20号">5号20号</option>
                <option value="免费代码">免费代码</option>
            </select>
            <button onclick="cancelBottomContent()">❌ 取消</button>
        </div>
        <div>底部预览:</div>
        <div id="bottom-preview"></div>
    </div>

    <div class="divider"></div>

    <div class="action-buttons">
        <button onclick="copyCode()">📄 复制代码</button>
    </div>
    <pre id="output">请填写内容以生成代码</pre>

    <script>
        const emojiMap = {
            "JDB": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348342/4_zbwwzg.png",
            "PG": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348343/2_n4m5ex.png",
            "CQ9": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348343/5_cepuhg.png",
            "PP": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348342/3_khmapl.png",
            "JILI": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348344/6_tsocr4.png",
            "TADA": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348345/7_ndnw7m.png",
            "WG": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348346/8_yvcb8c.png"
        };

        const bannerMap = {
            "VIP活动": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/1_suhssv.png", url: "https://3537s.com/#/sd-vip?game_type=11001&game_mode=1&anim_type=2" },
            "代理R$30": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/13_r4n0s7.png", url: "https://3537s.com/#/sdagency?game_type=11001&game_mode=1&anim_type=2" },
            "5%佣金": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/2_mgh4qp.png", url: "https://3537s.com/#/home?game_type=11001&game_mode=1&anim_type=2" },
            "神秘奖金R$8888": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/11_mc4ivy.png", url: "https://3537s.com/#/sdmystery?game_type=11001&game_mode=1&anim_type=2" },
            "MAGNATA": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/12_wfdyjn.png", url: "https://3537s.com/#/cashwheel?game_type=11001&game_mode=1&anim_type=2" },
            "每日亏损": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/4_cy1qca.png", url: "https://3537s.com/#/sd-rescue?game_type=11001&game_mode=1&anim_type=2" },
            "每周亏损": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348920/5_xakcw3.png", url: "https://3537s.com/#/sdweekb?game_type=11001&game_mode=1&anim_type=2" },
            "Nível": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/7_dndgoh.png", url: "https://3537s.com/#/sd-level?game_type=11001&game_mode=1&anim_type=2" },
            "HAPPY": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/8_gyaxzf.png", url: "https://3537s.com/#/sd-lottery?game_type=11001&game_mode=1&anim_type=2" },
            "5号20号": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/9_su8hwk.png", url: "https://3537s.com/#/sdsuper?game_type=11001&game_mode=1&anim_type=2" },
            "免费代码": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348920/6_z8m3dy.png", url: "https://3537s.com/#/giftcode?game_type=11001&game_mode=1&anim_type=2" }
        };

        let currentMode = '3537'; // 默认模式为 3537
        let bottomContent = "";
        let isJumpButton = false;
        let contentData = [];
        let generatedCode = "";
        let buttonConfig = {
            '3537': {
                buttonImg: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1741951273/button_-_3_ddqvtq.png",
                buttonUrl: "#/giftcode",
                jumpButtonImg: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1741934211/3537_BUTTON_4_mty74n.gif",
                jumpButtonUrl: "https://t.me/+9LQsBIYNZucxMmU1"
            },
            '6167': {
                buttonImg: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742470970/button_1_dihd5x.png",
                buttonUrl: "https://6167222.com/#/giftcode",
                jumpButtonImg: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742470964/6167_button_1_zi62sd.gif",
                jumpButtonUrl: "https://t.me/+qBIuPiTwI0U1NzA1"
            }
        };

        function switchMode(mode) {
            currentMode = mode;
            const btn3537 = document.getElementById('btn-3537');
            const btn6167 = document.getElementById('btn-6167');
            const bannerSelect = document.getElementById('bannerSelect');

            // 更新按钮高亮状态
            if (mode === '3537') {
                btn3537.classList.add('active');
                btn6167.classList.remove('active');
                bannerSelect.style.display = 'inline-block'; // 显示“选择横幅”
                document.title = '3537';
            } else {
                btn3537.classList.remove('active');
                btn6167.classList.add('active');
                bannerSelect.style.display = 'none'; // 隐藏“选择横幅”
                if (bottomContent && !isJumpButton) {
                    bottomContent = ""; // 如果当前底部内容是横幅，切换到 6167 模式时清空
                    document.getElementById("bottom-preview").innerHTML = "";
                }
                document.title = '6167';
            }

            // 更新页面标题
            generateCode();
        }

        document.getElementById("content").addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                range.deleteContents();

                const br = document.createElement("br");
                range.insertNode(br);

                const newRange = document.createRange();
                newRange.setStartAfter(br);
                newRange.setEndAfter(br);
                selection.removeAllRanges();
                selection.addRange(newRange);

                updateContent();
            } else if (e.key === "Backspace") {
                e.preventDefault();
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                if (!range.collapsed) {
                    range.deleteContents();
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    const startContainer = range.startContainer;
                    const startOffset = range.startOffset;

                    if (startContainer.nodeType === Node.TEXT_NODE) {
                        if (startOffset > 0) {
                            range.setStart(startContainer, startOffset - 1);
                            range.setEnd(startContainer, startOffset);
                            range.deleteContents();
                            range.setStart(startContainer, startOffset - 1);
                            range.setEnd(startContainer, startOffset - 1);
                        } else {
                            const previousSibling = startContainer.previousSibling;
                            if (previousSibling) {
                                if (previousSibling.nodeName === "BR") {
                                    previousSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                } else if (previousSibling.nodeName === "IMG") {
                                    previousSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            } else {
                                const parent = startContainer.parentNode;
                                const previousParentSibling = parent.previousSibling;
                                if (previousParentSibling && (previousParentSibling.nodeName === "BR" || previousParentSibling.nodeName === "IMG")) {
                                    previousParentSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            }
                        }
                    } else if (startContainer.nodeType === Node.ELEMENT_NODE) {
                        if (startOffset > 0) {
                            const previousNode = startContainer.childNodes[startOffset - 1];
                            if (previousNode) {
                                if (previousNode.nodeName === "BR") {
                                    previousNode.remove();
                                    range.setStart(startContainer, startOffset - 1);
                                    range.setEnd(startContainer, startOffset - 1);
                                } else if (previousNode.nodeName === "IMG") {
                                    previousNode.remove();
                                    range.setStart(startContainer, startOffset - 1);
                                    range.setEnd(startContainer, startOffset - 1);
                                } else if (previousNode.nodeType === Node.TEXT_NODE && previousNode.textContent.length > 0) {
                                    const textLength = previousNode.textContent.length;
                                    previousNode.textContent = previousNode.textContent.substring(0, textLength - 1);
                                    range.setStart(previousNode, textLength - 1);
                                    range.setEnd(previousNode, textLength - 1);
                                }
                            }
                        } else {
                            const previousSibling = startContainer.previousSibling;
                            if (previousSibling && (previousSibling.nodeName === "BR" || previousSibling.nodeName === "IMG")) {
                                previousSibling.remove();
                                range.setStart(startContainer, 0);
                                range.setEnd(startContainer, 0);
                            } else {
                                const parent = startContainer.parentNode;
                                const previousParentSibling = parent.previousSibling;
                                if (previousParentSibling && (previousParentSibling.nodeName === "BR" || previousParentSibling.nodeName === "IMG")) {
                                    previousParentSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            }
                        }
                    }

                    if (startContainer.nodeType === Node.ELEMENT_NODE && startContainer.childNodes.length === 0) {
                        const textNode = document.createTextNode("");
                        startContainer.appendChild(textNode);
                        range.setStart(textNode, 0);
                        range.setEnd(textNode, 0);
                    } else if (startContainer.nodeType === Node.TEXT_NODE && startContainer.textContent === "" && !startContainer.previousSibling && !startContainer.nextSibling) {
                        range.setStart(startContainer, 0);
                        range.setEnd(startContainer, 0);
                    }
                }
                selection.removeAllRanges();
                selection.addRange(range);
                updateContent();
            }
        });

        document.getElementById("content").addEventListener("paste", function(e) {
            e.preventDefault();
            const clipboardData = e.clipboardData || window.clipboardData;
            const htmlData = clipboardData.getData("text/html");
            const textData = clipboardData.getData("text/plain");

            if (htmlData && (htmlData.includes("button-img") || htmlData.includes("emoji-img"))) {
                const div = document.createElement("div");
                div.innerHTML = htmlData;
                const fragment = document.createDocumentFragment();
                let lastNodeWasBr = false;

                Array.from(div.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        if (text.trim() !== '' || lastNodeWasBr) {
                            fragment.appendChild(node.cloneNode(true));
                        }
                        lastNodeWasBr = false;
                    } else if (node.nodeName === "IMG" && (node.className === "button-img" || node.className === "emoji-img")) {
                        fragment.appendChild(node.cloneNode(true));
                        lastNodeWasBr = false;
                    } else if (node.nodeName === "BR") {
                        fragment.appendChild(document.createElement("br"));
                        lastNodeWasBr = true;
                    }
                });

                const selection = window.getSelection();
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(fragment);
                    range.setStartAfter(fragment.lastChild || fragment);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    document.getElementById("content").appendChild(fragment);
                }
            } else {
                const lines = textData.split(/\r?\n/);
                let html = '';
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    if (line) {
                        html += line;
                    }
                    if (i < lines.length - 1) {
                        html += '<br>';
                    }
                }
                document.execCommand("insertHTML", false, html);
            }
            updateContent();
        });

        function alignText(alignment) {
            const content = document.getElementById("content");
            const selection = window.getSelection();
            if (!selection.rangeCount || !selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) return;

            const range = selection.getRangeAt(0);
            if (range.collapsed) return;

            const td = range.commonAncestorContainer.parentNode.closest("td");
            if (td) {
                const fragment = range.extractContents();
                const alignDiv = document.createElement("div");
                alignDiv.style.textAlign = alignment;
                alignDiv.appendChild(fragment);
                range.insertNode(alignDiv);

                const newRange = document.createRange();
                const lastChild = alignDiv.lastChild;
                if (lastChild.nodeType === Node.TEXT_NODE) {
                    newRange.setStart(lastChild, lastChild.length);
                    newRange.setEnd(lastChild, lastChild.length);
                } else if (lastChild.nodeType === Node.ELEMENT_NODE) {
                    newRange.setStartAfter(lastChild);
                    newRange.setEndAfter(lastChild);
                } else {
                    newRange.setStart(alignDiv, alignDiv.childNodes.length);
                    newRange.setEnd(alignDiv, alignDiv.childNodes.length);
                }
                selection.removeAllRanges();
                selection.addRange(newRange);
            } else {
                const fragment = range.extractContents();
                const alignDiv = document.createElement("div");
                alignDiv.style.textAlign = alignment;
                alignDiv.appendChild(fragment);
                range.insertNode(alignDiv);

                let nextSibling = alignDiv.nextSibling;
                while (nextSibling && (nextSibling.nodeName === "BR" || (nextSibling.nodeType === Node.TEXT_NODE && nextSibling.textContent.trim() === ""))) {
                    const toRemove = nextSibling;
                    nextSibling = nextSibling.nextSibling;
                    toRemove.remove();
                }

                const newRange = document.createRange();
                const lastChild = alignDiv.lastChild;
                if (lastChild.nodeType === Node.TEXT_NODE) {
                    newRange.setStart(lastChild, lastChild.length);
                    newRange.setEnd(lastChild, lastChild.length);
                } else if (lastChild.nodeType === Node.ELEMENT_NODE) {
                    newRange.setStartAfter(lastChild);
                    newRange.setEndAfter(lastChild);
                } else {
                    newRange.setStart(alignDiv, alignDiv.childNodes.length);
                    newRange.setEnd(alignDiv, alignDiv.childNodes.length);
                }
                selection.removeAllRanges();
                selection.addRange(newRange);
            }

            updateContent();
        }

        function formatText(format) {
            const content = document.getElementById("content");
            const selection = window.getSelection();
            if (!selection.rangeCount || !selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) return;

            const range = selection.getRangeAt(0);
            const selectedText = range.toString();
            if (!selectedText) return;

            const span = document.createElement("span");
            if (format === "bold") {
                span.style.fontWeight = "bold";
            } else if (format === "italic") {
                span.style.fontStyle = "italic";
            } else if (format === "underline") {
                span.style.textDecoration = "underline";
            }
            span.textContent = selectedText;
            range.deleteContents();
            range.insertNode(span);

            const newRange = document.createRange();
            newRange.setStartAfter(span);
            newRange.collapse(true);
            selection.removeAllRanges();
            selection.addRange(newRange);

            updateContent();
        }

        function addTable() {
            const rows = parseInt(prompt("请输入表格行数：", "2"));
            const cols = parseInt(prompt("请输入表格列数：", "2"));

            if (!rows || !cols || rows <= 0 || cols <= 0) {
                alert("请输入有效的行数和列数！");
                return;
            }

            const content = document.getElementById("content");
            const table = document.createElement("table");
            table.dataset.code = `<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">`;

            for (let i = 0; i < rows; i++) {
                const tr = document.createElement("tr");
                table.dataset.code += "<tr>";
                for (let j = 0; j < cols; j++) {
                    const td = document.createElement("td");
                    td.textContent = " ";
                    tr.appendChild(td);
                    table.dataset.code += `<td style="border: 1px solid #FFFFFF; padding: 8px; text-align: center;"> </td>`;
                }
                table.dataset.code += "</tr>";
                table.appendChild(tr);
            }
            table.dataset.code += "</table>";

            const selection = window.getSelection();
            if (selection.rangeCount > 0 && selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) {
                const range = selection.getRangeAt(0);
                range.insertNode(table);
                range.setStartAfter(table);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            } else {
                content.appendChild(table);
            }
            updateContent();
        }

        function changeSelectedColor() {
             const content = document.getElementById("content");
            const selection = window.getSelection();
            if (!selection.rangeCount || !selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) return;

            const range = selection.getRangeAt(0);
            const selectedText = range.toString();
            if (!selectedText) return;

            const coloredSpan = document.createElement("span");
            coloredSpan.style.color = "#CAFF70";
            coloredSpan.textContent = selectedText;
            range.deleteContents();
            range.insertNode(coloredSpan);

            const defaultSpan = document.createElement("span");
            defaultSpan.style.color = "#000000";
            defaultSpan.textContent = "";
            range.insertNode(defaultSpan);

            selection.removeAllRanges();
            const newRange = document.createRange();
            newRange.setStart(defaultSpan, 0);
            newRange.collapse(true);
            selection.addRange(newRange);

            updateContent();
        }

        function addButton() {
            const content = document.getElementById("content");
            const img = document.createElement("img");
            img.src = buttonConfig[currentMode].buttonImg;
            img.alt = "Botão";
            img.className = "button-img";
            img.dataset.code = `<a href="${buttonConfig[currentMode].buttonUrl}" target="_self"><img src="${buttonConfig[currentMode].buttonImg}" alt="Botão" style="vertical-align: middle; width: 25%; filter: drop-shadow(0 0 10px #CAFF70);"/></a>`;

            const selection = window.getSelection();
            if (selection.rangeCount > 0 && selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) {
                const range = selection.getRangeAt(0);
                range.insertNode(img);
                range.setStartAfter(img);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            } else {
                content.appendChild(img);
            }
            updateContent();
        }

        function addEmoji() {
            const select = document.getElementById("emojiSelect");
            const value = select.value;
            if (value && emojiMap[value]) {
                const content = document.getElementById("content");
                const img = document.createElement("img");
                img.src = emojiMap[value];
                img.alt = "Logo";
                img.className = "emoji-img";
                img.dataset.code = `<img src="${emojiMap[value]}" alt="Logo" style="width: 12%; height: auto; vertical-align: middle; margin-top: 0px;"/>`;

                const selection = window.getSelection();
                if (selection.rangeCount > 0 && selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) {
                    const range = selection.getRangeAt(0);
                    range.insertNode(img);
                    range.setStartAfter(img);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    content.appendChild(img);
                }
                updateContent();
            }
            select.value = "";
        }

        function addJumpButton() {
            bottomContent = `<a href="${buttonConfig[currentMode].jumpButtonUrl}" target="_blank"><img src="${buttonConfig[currentMode].jumpButtonImg}" style="width: 80%; height: auto; margin-top: 10px; display:block; margin-left:auto; margin-right:auto;"/></a></div>`;
            isJumpButton = true;
            const preview = document.getElementById("bottom-preview");
            preview.innerHTML = `<img src="${buttonConfig[currentMode].jumpButtonImg}" style="width: 200px; height: auto;"/>`;
            generateCode();
        }

        function addBanner() {
            const select = document.getElementById("bannerSelect");
            const value = select.value;
            if (value && bannerMap[value]) {
                bottomContent = `<a href="${bannerMap[value].url}"><img src="${bannerMap[value].img}" alt="Atividade" style="display:block; margin: 20px auto; width: 100%; max-width: 1200px;"/></a></div>`;
                isJumpButton = false;
                const preview = document.getElementById("bottom-preview");
                preview.innerHTML = `<img src="${bannerMap[value].img}" style="width: 300px; height: auto;"/>`;
                generateCode();
            }
            select.value = "";
        }

        function cancelBottomContent() {
            bottomContent = "";
            isJumpButton = false;
            const preview = document.getElementById("bottom-preview");
            preview.innerHTML = "";
            generateCode();
        }

        function updateContent() {
            const content = document.getElementById("content");
            contentData = [];

            function processNode(node, isNestedDiv = false) {
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent;
                    if (text) {
                        contentData.push({ type: "text", value: text });
                    }
                } else if (node.nodeName === "SPAN") {
                    const styles = {};
                    if (node.style.color) styles.color = node.style.color;
                    if (node.style.fontWeight === "bold") styles.fontWeight = "bold";
                    if (node.style.fontStyle === "italic") styles.fontStyle = "italic";
                    if (node.style.textDecoration === "underline") styles.textDecoration = "underline";
                    contentData.push({ type: "span", value: node.textContent, styles: styles });
                } else if (node.nodeName === "DIV" && node !== content) {
                    contentData.push({ type: "div_start", align: node.style.textAlign });
                    node.childNodes.forEach(child => processNode(child, true));
                    contentData.push({ type: "div_end" });
                } else if (node.nodeName === "TABLE") {
                    const tableCode = generateTableCode(node);
                    contentData.push({ type: "table", code: tableCode });
                } else if (node.nodeName === "IMG") {
                    contentData.push({ type: "img", code: node.dataset.code });
                } else if (node.nodeName === "BR") {
                    contentData.push({ type: "br" });
                } else {
                    node.childNodes.forEach(child => processNode(child, isNestedDiv));
                }
            }

            function processTdContent(node) {
                let tdContent = "";
                if (node.nodeType === Node.TEXT_NODE) {
                    tdContent += node.textContent;
                } else if (node.nodeName === "DIV") {
                    const divContent = Array.from(node.childNodes).map(child => processTdContent(child)).join('');
                    tdContent += `<div style="text-align:${node.style.textAlign};">${divContent}</div>`;
                } else if (node.nodeName === "SPAN") {
                    const styles = [];
                    if (node.style.color) styles.push(`color:${node.style.color}`);
                    if (node.style.fontWeight === "bold") styles.push(`font-weight:bold`);
                    if (node.style.fontStyle === "italic") styles.push(`font-style:italic`);
                    if (node.style.textDecoration === "underline") styles.push(`text-decoration:underline`);
                    const spanContent = Array.from(node.childNodes).map(child => processTdContent(child)).join('');
                    tdContent += `<span style="${styles.join(';')}">${spanContent}</span>`;
                } else if (node.nodeName === "IMG") {
                    tdContent += node.dataset.code;
                } else if (node.nodeName === "BR") {
                    tdContent += "<br>";
                } else {
                    node.childNodes.forEach(child => {
                        tdContent += processTdContent(child);
                    });
                }
                return tdContent;
            }

            function generateTableCode(table) {
                let code = `<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">`;
                const rows = table.getElementsByTagName("tr");
                for (let i = 0; i < rows.length; i++) {
                    code += "<tr>";
                    const cells = rows[i].getElementsByTagName("td");
                    for (let j = 0; j < cells.length; j++) {
                        const td = cells[j];
                        let tdContent = "";
                        td.childNodes.forEach(child => {
                            tdContent += processTdContent(child);
                        });
                        code += `<td style="border: 1px solid #FFFFFF; padding: 8px; text-align: center;">${tdContent}</td>`;
                    }
                    code += "</tr>";
                }
                code += "</table>";
                return code;
            }

            content.childNodes.forEach(node => processNode(node));
            generateCode();
        }

        function generateCode() {
            const title = document.getElementById("title").value.trim();
            let output = `<div style="font-family:Arial,sans-serif;">`;
            if (title) {
                output += `<span style="color:#CAFF70;">${title}</span><br>\n`;
            }
            output += `<span style="color:#FFFFFF;">`;

            let inDiv = false;
            contentData.forEach((item, index) => {
                if (item.type === "text") {
                    output += item.value;
                } else if (item.type === "span") {
                    const styles = [];
                    if (item.styles.color) styles.push(`color:${item.styles.color}`);
                    if (item.styles.fontWeight) styles.push(`font-weight:${item.styles.fontWeight}`);
                    if (item.styles.fontStyle) styles.push(`font-style:${item.styles.fontStyle}`);
                    if (item.styles.textDecoration) styles.push(`text-decoration:${item.styles.textDecoration}`);
                    output += `<span style="${styles.join(';')}">${item.value}</span>`;
                } else if (item.type === "div_start") {
                    output += `<div style="text-align:${item.align};">`;
                    inDiv = true;
                } else if (item.type === "div_end") {
                    output += `</div>`;
                    inDiv = false;
                } else if (item.type === "table") {
                    output += item.code;
                } else if (item.type === "img") {
                    output += item.code;
                } else if (item.type === "br") {
                    if (!inDiv || (index < contentData.length - 1 && contentData[index + 1].type !== "div_end")) {
                        output += "\n";
                    }
                }
            });

            output += "</span>";

            if (bottomContent) {
                if (isJumpButton) {
                    output += "\n\n";
                }
                output += bottomContent;
            } else {
                output += "</div>";
            }
            generatedCode = output || "请填写内容以生成代码";
            document.getElementById("output").textContent = generatedCode;
        }

        function copyCode() {
            if (!generatedCode || generatedCode === "请填写内容以生成代码") {
                alert("请填写内容以生成代码！");
                return;
            }
            navigator.clipboard.writeText(generatedCode);

            let successMessage = document.querySelector('.copy-success');
            if (!successMessage) {
                successMessage = document.createElement('div');
                successMessage.className = 'copy-success';
                successMessage.textContent = '复制成功！';
                document.getElementById("output").appendChild(successMessage);
            }

            successMessage.classList.add('show');
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 2000);
        }

        document.getElementById("title").addEventListener("input", updateContent);
        generateCode();
    </script>
</body>
</html>
