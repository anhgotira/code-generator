<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3537.COM</title>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); /* æ›´æ·±é‚ƒçš„æ¸å˜èƒŒæ™¯ */
            color: #F1F5F9;
            perspective: 800px;
        }
        h1 {
            text-align: center;
            color: #38BDF8; /* æ›´æ˜äº®çš„æ ‡é¢˜é¢œè‰² */
            font-size: 2.8em;
            margin-bottom: 50px;
            text-shadow: 0 2px 8px rgba(56, 189, 248, 0.5);
            transform: translateZ(15px);
            animation: float 4s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) translateZ(15px); }
            50% { transform: translateY(-8px) translateZ(15px); }
        }
        .input-section {
            margin-bottom: 40px;
            background: linear-gradient(135deg, #1E293B 0%, #334155 100%); /* æ›´æŸ”å’Œçš„å¡ç‰‡èƒŒæ™¯ */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5), inset 0 1px 3px rgba(255, 255, 255, 0.05);
            transform: translateZ(8px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .input-section:hover {
            transform: translateZ(15px) translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6), inset 0 1px 3px rgba(255, 255, 255, 0.1);
        }
        label {
            font-weight: 600;
            color: #38BDF8; /* æ ‡ç­¾é¢œè‰²ä¸æ ‡é¢˜ä¸€è‡´ */
            display: block;
            margin-bottom: 12px;
            font-size: 1.2em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        textarea, .editable-div {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            resize: vertical;
            background: linear-gradient(135deg, #334155 0%, #475569 100%); /* è¾“å…¥æ¡†æ›´æŸ”å’Œçš„æ¸å˜ */
            color: #F1F5F9;
            border: 2px solid #64748B;
            border-radius: 12px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2), 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease, transform 0.3s ease;
            transform: translateZ(5px);
        }
        textarea:hover, .editable-div:hover {
            border-color: #38BDF8;
            background: linear-gradient(135deg, #475569 0%, #5B7286 100%);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(56, 189, 248, 0.3);
            transform: translateZ(8px);
        }
        textarea:focus, .editable-div:focus {
            border-color: #38BDF8;
            background: linear-gradient(135deg, #475569 0%, #5B7286 100%);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2), 0 5px 20px rgba(56, 189, 248, 0.5);
            transform: translateZ(8px);
            outline: none;
        }
        #title {
            min-height: 50px;
        }
        #content {
            min-height: 160px;
            white-space: pre-wrap;
        }
        .toolbar {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        button, select {
            padding: 14px 28px;
            font-size: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }
        button {
            background: linear-gradient(135deg, #F97316 0%, #FBBF24 100%); /* æ›´é²œè‰³çš„æŒ‰é’®æ¸å˜ */
            color: #FFFFFF;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(249, 115, 22, 0.4), inset 0 1px 3px rgba(255, 255, 255, 0.2);
            transform: translateZ(8px);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        button:hover {
            background: linear-gradient(135deg, #FBBF24 0%, #F97316 100%);
            transform: translateZ(12px) translateY(-2px);
            box-shadow: 0 8px 20px rgba(249, 115, 22, 0.5), inset 0 1px 3px rgba(255, 255, 255, 0.3), 0 0 10px rgba(249, 115, 22, 0.4);
        }
        button:active {
            transform: translateZ(5px) scale(0.95);
            box-shadow: 0 3px 10px rgba(249, 115, 22, 0.3), inset 0 1px 3px rgba(255, 255, 255, 0.2);
        }
        select {
            background: linear-gradient(135deg, #334155 0%, #475569 100%); /* ä¸‹æ‹‰æ¡†ä¸è¾“å…¥æ¡†ä¸€è‡´ */
            border: 2px solid #64748B;
            color: #F1F5F9;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: translateZ(5px);
        }
        select:focus {
            border-color: #38BDF8;
            box-shadow: 0 5px 15px rgba(56, 189, 248, 0.3);
            outline: none;
        }
        select option {
            background: #334155;
            color: #38BDF8;
        }
        #output {
            white-space: pre-wrap;
            padding: 20px;
            border: 2px solid #64748B;
            border-radius: 12px;
            background: linear-gradient(135deg, #1E293B 0%, #334155 100%); /* è¾“å‡ºæ¡†æ›´æ·±é‚ƒ */
            color: #E5E7EB;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transform: translateZ(5px);
            font-family: 'Courier New', Courier, monospace;
            position: relative;
        }
        #bottom-preview {
            margin-top: 10px;
            padding: 15px;
            border: 2px solid #64748B;
            border-radius: 12px;
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            min-height: 60px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: translateZ(5px);
        }
        #content img.button-img {
            width: 100px;
            vertical-align: middle;
        }
        #content img.emoji-img {
            width: 30px;
            vertical-align: middle;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }
        .divider {
            border-top: 1px solid #64748B; /* åˆ†å‰²çº¿é¢œè‰²æ›´æŸ”å’Œ */
            margin: 40px 0;
        }
        .copy-success {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(56, 189, 248, 0.9); /* ä¸ä¸»é¢˜è‰²ä¸€è‡´ */
            color: #FFFFFF;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        .copy-success.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>âœ¨ 3537.COM âœ¨</h1>

    <div class="input-section">
        <label>ğŸ“ ä¸»é¢˜</label>
        <textarea id="title" placeholder="è¾“å…¥ä¸»é¢˜"></textarea>
    </div>

    <div class="input-section">
        <label>ğŸ“‹ å†…å®¹</label>
        <div id="content" class="editable-div" contenteditable="true" oninput="updateContent()"></div>
        <div class="toolbar">
            <button onclick="changeSelectedColor()">ğŸ¨ é€‰ä¸­å†…å®¹å˜è‰²</button>
            <button onclick="addButton()">â• æ·»åŠ æŒ‰é’®</button>
            <select id="emojiSelect" onchange="addEmoji()">
                <option value="">é€‰æ‹©æ¸¸æˆ Emoji</option>
                <option value="JDB">JDB</option>
                <option value="PG">PG</option>
                <option value="CQ9">CQ9</option>
                <option value="PP">PP</option>
                <option value="JILI">JILI</option>
                <option value="TADA">TADA</option>
                <option value="WG">WG</option>
            </select>
        </div>
    </div>

    <div class="input-section">
        <label>ğŸ”— åº•éƒ¨é€‰é¡¹</label>
        <div class="toolbar">
            <button onclick="addJumpButton()">ğŸ”— æ·»åŠ è·³è½¬æŒ‰é’®</button>
            <select id="bannerSelect" onchange="addBanner()">
                <option value="">é€‰æ‹©æ¨ªå¹…</option>
                <option value="VIPæ´»åŠ¨">VIPæ´»åŠ¨</option>
                <option value="ä»£ç†R$30">ä»£ç†R$30</option>
                <option value="5%ä½£é‡‘">5%ä½£é‡‘</option>
                <option value="ç¥ç§˜å¥–é‡‘R$8888">ç¥ç§˜å¥–é‡‘R$8888</option>
                <option value="MAGNATA">MAGNATA</option>
                <option value="æ¯æ—¥äºæŸ">æ¯æ—¥äºæŸ</option>
                <option value="æ¯å‘¨äºæŸ">æ¯å‘¨äºæŸ</option>
                <option value="NÃ­vel">NÃ­vel</option>
                <option value="HAPPY">HAPPY</option>
                <option value="5å·20å·">5å·20å·</option>
                <option value="å…è´¹ä»£ç ">å…è´¹ä»£ç </option>
            </select>
        </div>
        <div>åº•éƒ¨é¢„è§ˆ:</div>
        <div id="bottom-preview"></div>
    </div>

    <div class="divider"></div>

    <div class="action-buttons">
        <button onclick="generateCode()">ğŸ“¦ ç”Ÿæˆä»£ç </button>
        <button onclick="copyCode()">ğŸ“„ å¤åˆ¶ä»£ç </button>
    </div>
    <pre id="output">è¯·ç‚¹å‡»â€œç”Ÿæˆä»£ç â€æŒ‰é’®ä»¥ç”Ÿæˆä»£ç </pre>

    <script>
        const emojiMap = {
            "JDB": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348342/4_zbwwzg.png",
            "PG": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348343/2_n4m5ex.png",
            "CQ9": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348343/5_cepuhg.png",
            "PP": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348342/3_khmapl.png",
            "JILI": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348344/6_tsocr4.png",
            "TADA": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348345/7_ndnw7m.png",
            "WG": "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348346/8_yvcb8c.png"
        };

        const bannerMap = {
            "VIPæ´»åŠ¨": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/1_suhssv.png", url: "https://3537s.com/#/sd-vip?game_type=11001&game_mode=1&anim_type=2" },
            "ä»£ç†R$30": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/13_r4n0s7.png", url: "https://3537s.com/#/sdagency?game_type=11001&game_mode=1&anim_type=2" },
            "5%ä½£é‡‘": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/2_mgh4qp.png", url: "https://3537s.com/#/home?game_type=11001&game_mode=1&anim_type=2" },
            "ç¥ç§˜å¥–é‡‘R$8888": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/11_mc4ivy.png", url: "https://3537s.com/#/sdmystery?game_type=11001&game_mode=1&anim_type=2" },
            "MAGNATA": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/12_wfdyjn.png", url: "https://3537s.com/#/cashwheel?game_type=11001&game_mode=1&anim_type=2" },
            "æ¯æ—¥äºæŸ": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/4_cy1qca.png", url: "https://3537s.com/#/sd-rescue?game_type=11001&game_mode=1&anim_type=2" },
            "æ¯å‘¨äºæŸ": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348920/5_xakcw3.png", url: "https://3537s.com/#/sdweekb?game_type=11001&game_mode=1&anim_type=2" },
            "NÃ­vel": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348921/7_dndgoh.png", url: "https://3537s.com/#/sd-level?game_type=11001&game_mode=1&anim_type=2" },
            "HAPPY": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/8_gyaxzf.png", url: "https://3537s.com/#/sd-lottery?game_type=11001&game_mode=1&anim_type=2" },
            "5å·20å·": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742372370/9_su8hwk.png", url: "https://3537s.com/#/sdsuper?game_type=11001&game_mode=1&anim_type=2" },
            "å…è´¹ä»£ç ": { img: "https://res.cloudinary.com/daw3jjnsf/image/upload/v1742348920/6_z8m3dy.png", url: "https://3537s.com/#/giftcode?game_type=11001&game_mode=1&anim_type=2" }
        };

        let bottomContent = "";
        let isJumpButton = false;
        let contentData = [];
        let generatedCode = "";

        document.getElementById("content").addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                range.deleteContents();

                const br = document.createElement("br");
                range.insertNode(br);

                const newRange = document.createRange();
                newRange.setStartAfter(br);
                newRange.setEndAfter(br);
                selection.removeAllRanges();
                selection.addRange(newRange);

                updateContent();
            } else if (e.key === "Backspace") {
                e.preventDefault();
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);
                if (!range.collapsed) {
                    range.deleteContents();
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    const startContainer = range.startContainer;
                    const startOffset = range.startOffset;

                    if (startContainer.nodeType === Node.TEXT_NODE) {
                        if (startOffset > 0) {
                            range.setStart(startContainer, startOffset - 1);
                            range.setEnd(startContainer, startOffset);
                            range.deleteContents();
                            range.setStart(startContainer, startOffset - 1);
                            range.setEnd(startContainer, startOffset - 1);
                        } else {
                            const previousSibling = startContainer.previousSibling;
                            if (previousSibling) {
                                if (previousSibling.nodeName === "BR") {
                                    previousSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                } else if (previousSibling.nodeName === "IMG") {
                                    previousSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            } else {
                                const parent = startContainer.parentNode;
                                const previousParentSibling = parent.previousSibling;
                                if (previousParentSibling && (previousParentSibling.nodeName === "BR" || previousParentSibling.nodeName === "IMG")) {
                                    previousParentSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            }
                        }
                    } else if (startContainer.nodeType === Node.ELEMENT_NODE) {
                        if (startOffset > 0) {
                            const previousNode = startContainer.childNodes[startOffset - 1];
                            if (previousNode) {
                                if (previousNode.nodeName === "BR") {
                                    previousNode.remove();
                                    range.setStart(startContainer, startOffset - 1);
                                    range.setEnd(startContainer, startOffset - 1);
                                } else if (previousNode.nodeName === "IMG") {
                                    previousNode.remove();
                                    range.setStart(startContainer, startOffset - 1);
                                    range.setEnd(startContainer, startOffset - 1);
                                } else if (previousNode.nodeType === Node.TEXT_NODE && previousNode.textContent.length > 0) {
                                    const textLength = previousNode.textContent.length;
                                    previousNode.textContent = previousNode.textContent.substring(0, textLength - 1);
                                    range.setStart(previousNode, textLength - 1);
                                    range.setEnd(previousNode, textLength - 1);
                                }
                            }
                        } else {
                            const previousSibling = startContainer.previousSibling;
                            if (previousSibling && (previousSibling.nodeName === "BR" || previousSibling.nodeName === "IMG")) {
                                previousSibling.remove();
                                range.setStart(startContainer, 0);
                                range.setEnd(startContainer, 0);
                            } else {
                                const parent = startContainer.parentNode;
                                const previousParentSibling = parent.previousSibling;
                                if (previousParentSibling && (previousParentSibling.nodeName === "BR" || previousParentSibling.nodeName === "IMG")) {
                                    previousParentSibling.remove();
                                    range.setStart(startContainer, 0);
                                    range.setEnd(startContainer, 0);
                                }
                            }
                        }
                    }

                    if (startContainer.nodeType === Node.ELEMENT_NODE && startContainer.childNodes.length === 0) {
                        const textNode = document.createTextNode("");
                        startContainer.appendChild(textNode);
                        range.setStart(textNode, 0);
                        range.setEnd(textNode, 0);
                    } else if (startContainer.nodeType === Node.TEXT_NODE && startContainer.textContent === "" && !startContainer.previousSibling && !startContainer.nextSibling) {
                        range.setStart(startContainer, 0);
                        range.setEnd(startContainer, 0);
                    }
                }
                selection.removeAllRanges();
                selection.addRange(range);
                updateContent();
            }
        });

        document.getElementById("content").addEventListener("paste", function(e) {
            e.preventDefault();
            const clipboardData = e.clipboardData || window.clipboardData;
            const htmlData = clipboardData.getData("text/html");
            const textData = clipboardData.getData("text/plain");

            if (htmlData && (htmlData.includes("button-img") || htmlData.includes("emoji-img"))) {
                const div = document.createElement("div");
                div.innerHTML = htmlData;
                const fragment = document.createDocumentFragment();
                let lastNodeWasBr = false;

                Array.from(div.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        if (text.trim() !== '' || lastNodeWasBr) {
                            fragment.appendChild(node.cloneNode(true));
                        }
                        lastNodeWasBr = false;
                    } else if (node.nodeName === "IMG" && (node.className === "button-img" || node.className === "emoji-img")) {
                        fragment.appendChild(node.cloneNode(true));
                        lastNodeWasBr = false;
                    } else if (node.nodeName === "BR") {
                        fragment.appendChild(document.createElement("br"));
                        lastNodeWasBr = true;
                    }
                });

                const selection = window.getSelection();
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(fragment);
                    range.setStartAfter(fragment.lastChild || fragment);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    document.getElementById("content").appendChild(fragment);
                }
            } else {
                const lines = textData.split(/\r?\n/);
                let html = '';
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    if (line) {
                        html += line;
                    }
                    if (i < lines.length - 1) {
                        html += '<br>';
                    }
                }
                document.execCommand("insertHTML", false, html);
            }
            updateContent();
        });

        function changeSelectedColor() {
            const content = document.getElementById("content");
            const selection = window.getSelection();
            if (!selection.rangeCount || !selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) return;

            const range = selection.getRangeAt(0);
            const selectedText = range.toString();
            if (!selectedText) return;

            let colorPicker = document.getElementById("colorPicker");
            if (!colorPicker) {
                colorPicker = document.createElement("div");
                colorPicker.id = "colorPicker";
                colorPicker.style.cssText = `
                    position: absolute;
                    background: #1E293B;
                    padding: 15px;
                    border-radius: 12px;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
                    z-index: 1000;
                    max-height: 300px;
                    overflow-y: auto;
                    display: grid;
                    grid-template-columns: repeat(5, 1fr);
                    gap: 10px;
                `;
                document.body.appendChild(colorPicker);
            }

            const colors = [
                "#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FF00FF", "#00FFFF", "#800000", "#008000", "#000080",
                "#808000", "#800080", "#008080", "#C0C0C0", "#808080", "#FFA500", "#A52A2A", "#D2691E", "#DC143C",
                "#FF4500", "#2E8B57", "#ADFF2F", "#9ACD32", "#228B22", "#6A5ACD", "#483D8B", "#7B68EE", "#BA55D3",
                "#9932CC", "#8A2BE2", "#9400D3", "#FFD700", "#DAA520", "#B8860B", "#CD853F", "#F4A460", "#DEB887",
                "#BC8F8F", "#F08080", "#FA8072", "#E9967A", "#FF6347", "#FF7F50", "#CD5C5C", "#B22222", "#8B0000",
                "#FFA07A", "#FF8C00", "#FFDAB9", "#EEE8AA", "#BDB76B", "#F0E68C", "#FFFFE0", "#98FB98", "#90EE90",
                "#00FF7F", "#7FFF00", "#7CFC00", "#ADFF2F", "#32CD32", "#00FA9A", "#00CED1", "#40E0D0", "#48D1CC",
                "#20B2AA", "#5F9EA0", "#B0E0E6", "#ADD8E6", "#87CEEB", "#87CEFA", "#00B7EB", "#1E90FF", "#4169E1",
                "#6495ED", "#4682B4", "#B0C4DE", "#778899", "#E6E6FA", "#D8BFD8", "#DDA0DD", "#EE82EE", "#DA70D6",
                "#FF00FF", "#C71585", "#DB7093", "#FFB6C1", "#FF69B4", "#FF1493", "#C71585", "#F0F8FF", "#F5F5DC",
                "#FFF8DC", "#FFFACD", "#FAFAD2", "#FFFFF0", "#F0FFF0", "#F0FFFF", "#E0FFFF", "#AFEEEE", "#7FFFD4",
                "#66CDAA", "#00FFFF", "#E0FFFF", "#00CED1", "#40E0D0", "#48D1CC", "#20B2AA", "#5F9EA0", "#4682B4",
                "#B0C4DE", "#778899", "#708090", "#2F4F4F", "#191970", "#000080", "#00008B", "#0000CD", "#0000FF",
                "#1E90FF", "#00B7EB", "#87CEFA", "#87CEEB", "#ADD8E6", "#B0E0E6", "#E6E6FA", "#DDA0DD", "#EE82EE",
                "#DA70D6", "#FF00FF", "#BA55D3", "#9370DB", "#8A2BE2", "#9400D3", "#9932CC", "#4B0082", "#6A5ACD"
            ];

            colorPicker.innerHTML = "";
            colors.forEach(color => {
                const colorBox = document.createElement("div");
                colorBox.style.cssText = `
                    width: 30px;
                    height: 30px;
                    background: ${color};
                    border-radius: 5px;
                    cursor: pointer;
                    border: 2px solid #64748B;
                    transition: transform 0.2s ease;
                `;
                colorBox.addEventListener("mouseover", () => {
                    colorBox.style.transform = "scale(1.1)";
                });
                colorBox.addEventListener("mouseout", () => {
                    colorBox.style.transform = "scale(1)";
                });
                colorBox.addEventListener("click", () => {
                    applyColor(color);
                    colorPicker.remove();
                });
                colorPicker.appendChild(colorBox);
            });

            const rect = range.getBoundingClientRect();
            colorPicker.style.left = `${rect.left + window.scrollX}px`;
            colorPicker.style.top = `${rect.bottom + window.scrollY + 5}px`;

            const closePicker = (e) => {
                if (!colorPicker.contains(e.target)) {
                    colorPicker.remove();
                    document.removeEventListener("click", closePicker);
                }
            };
            setTimeout(() => document.addEventListener("click", closePicker), 0);

            function applyColor(color) {
                const coloredSpan = document.createElement("span");
                coloredSpan.style.color = color;
                coloredSpan.textContent = selectedText;
                range.deleteContents();
                range.insertNode(coloredSpan);

                const defaultSpan = document.createElement("span");
                defaultSpan.style.color = "#000000";
                defaultSpan.textContent = "";
                range.insertNode(defaultSpan);

                selection.removeAllRanges();
                const newRange = document.createRange();
                newRange.setStart(defaultSpan, 0);
                newRange.collapse(true);
                selection.addRange(newRange);

                updateContent();
            }
        }

        function addButton() {
            const content = document.getElementById("content");
            const img = document.createElement("img");
            img.src = "https://res.cloudinary.com/daw3jjnsf/image/upload/v1741951273/button_-_3_ddqvtq.png";
            img.alt = "BotÃ£o";
            img.className = "button-img";
            img.dataset.code = `<a href="#/giftcode" target="_self"><img src="https://res.cloudinary.com/daw3jjnsf/image/upload/v1741951273/button_-_3_ddqvtq.png" alt="BotÃ£o" style="vertical-align: middle; width: 25%; filter: drop-shadow(0 0 10px #CAFF70);"/></a>`;

            const selection = window.getSelection();
            if (selection.rangeCount > 0 && selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) {
                const range = selection.getRangeAt(0);
                range.insertNode(img);
                range.setStartAfter(img);
                range.collapse(true);
                selection.removeAllRanges();
                selection.addRange(range);
            } else {
                content.appendChild(img);
            }
            updateContent();
        }

        function addEmoji() {
            const select = document.getElementById("emojiSelect");
            const value = select.value;
            if (value && emojiMap[value]) {
                const content = document.getElementById("content");
                const img = document.createElement("img");
                img.src = emojiMap[value];
                img.alt = "Logo";
                img.className = "emoji-img";
                img.dataset.code = `<img src="${emojiMap[value]}" alt="Logo" style="width: 12%; height: auto; vertical-align: middle; margin-top: 0px;"/>`;

                const selection = window.getSelection();
                if (selection.rangeCount > 0 && selection.getRangeAt(0).commonAncestorContainer.parentNode.closest("#content")) {
                    const range = selection.getRangeAt(0);
                    range.insertNode(img);
                    range.setStartAfter(img);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    content.appendChild(img);
                }
                updateContent();
            }
            select.value = "";
        }

        function addJumpButton() {
            bottomContent = `<a href="https://t.me/+9LQsBIYNZucxMmU1" target="_blank"><img src="https://res.cloudinary.com/daw3jjnsf/image/upload/v1741934211/3537_BUTTON_4_mty74n.gif" style="width: 80%; height: auto; margin-top: 10px; display:block; margin-left:auto; margin-right:auto;"/></a></div>`;
            isJumpButton = true;
            const preview = document.getElementById("bottom-preview");
            preview.innerHTML = `<img src="https://res.cloudinary.com/daw3jjnsf/image/upload/v1741934211/3537_BUTTON_4_mty74n.gif" style="width: 200px; height: auto;"/>`;
        }

        function addBanner() {
            const select = document.getElementById("bannerSelect");
            const value = select.value;
            if (value && bannerMap[value]) {
                bottomContent = `<a href="${bannerMap[value].url}"><img src="${bannerMap[value].img}" alt="Atividade" style="display:block; margin: 20px auto; width: 100%; max-width: 1200px;"/></a></div>`;
                isJumpButton = false;
                const preview = document.getElementById("bottom-preview");
                preview.innerHTML = `<img src="${bannerMap[value].img}" style="width: 300px; height: auto;"/>`;
            }
            select.value = "";
        }

        function updateContent() {
            const content = document.getElementById("content");
            contentData = [];

            function processNode(node, isNestedDiv = false) {
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent;
                    if (text) {
                        contentData.push({ type: "text", value: text });
                    }
                } else if (node.nodeName === "SPAN") {
                    contentData.push({ type: "span", value: node.textContent, color: node.style.color });
                } else if (node.nodeName === "IMG") {
                    contentData.push({ type: "img", code: node.dataset.code });
                } else if (node.nodeName === "BR") {
                    contentData.push({ type: "br" });
                } else if (node.nodeName === "DIV" && node !== content) {
                    let hasContent = false;
                    node.childNodes.forEach(child => {
                        if (child.nodeType === Node.TEXT_NODE && child.textContent.trim()) {
                            hasContent = true;
                        } else if (child.nodeName === "SPAN" || child.nodeName === "IMG") {
                            hasContent = true;
                        }
                        processNode(child, true);
                    });
                    if (hasContent && !isLastDiv(node, content)) {
                        contentData.push({ type: "br" });
                    }
                } else {
                    node.childNodes.forEach(child => processNode(child, isNestedDiv));
                }
            }

            function isLastDiv(node, parent) {
                const siblings = Array.from(parent.childNodes);
                const divs = siblings.filter(n => n.nodeName === "DIV" && n !== parent);
                return divs.length > 0 && divs[divs.length - 1] === node;
            }

            content.childNodes.forEach(node => processNode(node));
        }

        function generateCode() {
            const title = document.getElementById("title").value.trim();
            let output = `<div style="font-family:Arial,sans-serif;">`;
            if (title) {
                output += `<span style="color:#CAFF70;">${title}</span><br>\n`;
            }
            output += `<span style="color:#FFFFFF;">`;

            contentData.forEach(item => {
                if (item.type === "text") {
                    const lines = item.value.split('\n');
                    lines.forEach((line, index) => {
                        if (line) {
                            output += line;
                        }
                        if (index < lines.length - 1) {
                            output += "\n";
                        }
                    });
                } else if (item.type === "span") {
                    output += `<span style="color:${item.color};">${item.value}</span>`;
                } else if (item.type === "img") {
                    output += item.code;
                } else if (item.type === "br") {
                    output += "\n";
                }
            });

            output += "</span>";

            if (bottomContent) {
                if (isJumpButton) {
                    output += "\n\n";
                }
                output += bottomContent;
            } else {
                output += "</div>";
            }
            generatedCode = output || "è¯·å¡«å†™å†…å®¹";
            document.getElementById("output").textContent = generatedCode;
        }

        function copyCode() {
            if (!generatedCode) {
                alert("è¯·å…ˆç‚¹å‡»â€œç”Ÿæˆä»£ç â€æŒ‰é’®ç”Ÿæˆä»£ç ï¼");
                return;
            }
            navigator.clipboard.writeText(generatedCode);

            let successMessage = document.querySelector('.copy-success');
            if (!successMessage) {
                successMessage = document.createElement('div');
                successMessage.className = 'copy-success';
                successMessage.textContent = 'å¤åˆ¶æˆåŠŸï¼';
                document.getElementById("output").appendChild(successMessage);
            }

            successMessage.classList.add('show');
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 2000);
        }

        document.getElementById("title").addEventListener("input", updateContent);
    </script>
</body>
</html>
